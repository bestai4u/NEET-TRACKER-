<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NEET 2026 Study Dashboard</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- FullCalendar -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <!-- Google Identity Services & Calendar API -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/index.min.js"></script>

  <style>
  :root{
    --physics:#4285f4; --chemistry:#ff6d01; --biology:#34a853;
    --gym:#a142f4; --revision:#fbbc04; --bg:#fafafa; --card:#fff;
    --text:#202124; --text-secondary:#5f6368; --border:#e0e0e0;
    --gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  }
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}
  body{background:var(--bg);color:var(--text);line-height:1.6}
  .container{display:grid;grid-template-columns:1fr 1fr;gap:24px;padding:24px;max-width:1400px;margin:0 auto}
  @media(max-width:768px){.container{grid-template-columns:1fr;padding:8px;gap:12px}}
  .panel{background:var(--card);border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.1);padding:20px}
  .panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;border-bottom:1px solid var(--border);padding-bottom:12px}
  .panel-title{font-size:22px;font-weight:600}
  .date-display{font-size:18px;color:var(--text-secondary);margin-bottom:12px}
  .streak-counter{display:flex;align-items:center;gap:12px;padding:14px;border-radius:12px;background:var(--gradient);color:#fff;font-weight:600}
  .streak-icon{font-size:28px;animation:pulse 2s infinite}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
  .checklist-item{display:flex;align-items:center;gap:12px;padding:14px;margin-bottom:8px;border-radius:12px;background:#fafafa;cursor:pointer}
  .checklist-item.completed{background:#e8f5e8}
  .subject-tag{padding:4px 12px;border-radius:20px;font-size:12px;color:#fff;min-width:80px;text-align:center}
  .checkbox{width:26px;height:26px;border:2px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .checkbox.checked{background:var(--gradient);border-color:transparent;color:#fff;font-weight:700}
  .task-text{flex:1;font-size:15px}
  .task-text.completed{text-decoration:line-through;color:var(--text-secondary)}
  .progress-container{margin-top:20px}
  .progress-bar{height:10px;background:#e0e0e0;border-radius:5px;overflow:hidden}
  .progress-fill{height:100%;background:var(--gradient);transition:width .4s}
  .progress-text{text-align:center;margin-top:6px;font-size:14px;font-weight:600;color:var(--text-secondary)}

  /* Pomodoro */
  .pomodoro{margin-top:24px;text-align:center}
  .pomodoro-display{font-size:32px;font-weight:700;font-family:monospace;margin-bottom:8px}
  .pomodoro-controls{display:flex;gap:8px;justify-content:center}
  .pomodoro-btn{padding:8px 16px;border:none;border-radius:8px;background:var(--gradient);color:#fff;font-size:14px;cursor:pointer}
  .pomodoro-btn:active{transform:scale(.95)}
  .pomodoro-mode{font-size:14px;color:var(--text-secondary)}

  .google-signin{margin-bottom:20px;text-align:center}
  .form-textarea{width:100%;min-height:60px;padding:12px;border:1px solid var(--border);border-radius:8px;resize:vertical;font-size:14px;background:#fafafa}
  .save-button{width:100%;padding:14px;border:none;border-radius:8px;background:var(--gradient);color:#fff;font-size:16px;font-weight:600;cursor:pointer}
  </style>
</head>

<body>
<div class="container">

  <!-- LEFT PANEL -->
  <div class="panel">
    <div class="panel-header"><h2 class="panel-title">Today's Study Plan</h2></div>
    <div class="date-display" id="today-date"></div>
    <div class="streak-counter">
      <span class="streak-icon">üî•</span>
      <span><span id="streak-number">0</span> day streak!</span>
    </div>

    <div id="checklist" class="checklist"></div>

    <div class="progress-container">
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
      <div class="progress-text" id="progress-text">0% completed</div>
    </div>

    <!-- Pomodoro Timer -->
    <div class="pomodoro">
      <div class="pomodoro-display" id="timer">25:00</div>
      <div class="pomodoro-controls">
        <button class="pomodoro-btn" onclick="pomodoroStart()">‚ñ∂ Start</button>
        <button class="pomodoro-btn" onclick="pomodoroPause()">‚è∏ Pause</button>
        <button class="pomodoro-btn" onclick="pomodoroReset()">‚èπ Reset</button>
      </div>
      <div class="pomodoro-mode" id="mode">Work</div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="panel">
    <div class="panel-header"><h2 class="panel-title">Calendar & Reflection</h2></div>

    <!-- Google Identity Services -->
    <div class="google-signin">
      <div id="g_id_onload"
           data-client_id="1010185464516-utcu4mcaq0gsc7alh0drqikreq9lre74.apps.googleusercontent.com"
           data-callback="handleCredentialResponse"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin"
           data-type="standard"
           data-size="large"
           data-theme="outline"
           data-text="sign_in_with"
           data-shape="rectangular">
      </div>
    </div>

    <div id="calendar" style="height:350px;margin-bottom:20px"></div>

    <div class="reflection-form">
      <h3>Daily Reflection</h3>
      <label>What I will do today</label>
      <textarea class="form-textarea" id="today-plan"></textarea>
      <label>What I did today</label>
      <textarea class="form-textarea" id="today-done"></textarea>
      <label>Achievements today</label>
      <textarea class="form-textarea" id="achievements"></textarea>
      <label>Regrets today</label>
      <textarea class="form-textarea" id="regrets"></textarea>
      <label>Mistakes I will not make again</label>
      <textarea class="form-textarea" id="mistakes"></textarea>
      <button class="save-button" onclick="saveReflection()">Save Reflection</button>
      <div class="timestamp" id="last-saved">Not saved yet</div>
    </div>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const API_KEY   = 'AIzaSyBY7RyrrWyDihjC0FLWJeEqo8nLiMEa8zo';
const CLIENT_ID = '1010185464516-utcu4mcaq0gsc7alh0drqikreq9lre74.apps.googleusercontent.com';

/* ---------- GLOBALS ---------- */
let checklistData = [];
let calendar;
let isSignedIn = false;
let selectedDate = new Date().toISOString().split('T')[0];

/* ---------- INIT ---------- */
document.addEventListener('DOMContentLoaded', () => {
  loadChecklist();
  updateDate();
  initializeCalendar();
  loadReflection(selectedDate);
  loadStreak();
  pomodoroRender();
});

/* ---------- CHECKLIST ---------- */
const defaultTasks = [
  {text:"Physics - Mechanics Practice",subject:"physics",completed:false},
  {text:"Chemistry - Organic Reactions",subject:"chemistry",completed:false},
  {text:"Biology - Human Physiology",subject:"biology",completed:false},
  {text:"Gym - 30 min workout",subject:"gym",completed:false},
  {text:"Revision - Flashcards review",subject:"revision",completed:false}
];

function loadChecklist() {
  checklistData = JSON.parse(localStorage.getItem('checklist') || JSON.stringify(defaultTasks));
  renderChecklist();
  updateProgress();
}
function renderChecklist() {
  const c = document.getElementById('checklist');
  c.innerHTML = '';
  checklistData.forEach((t,i)=>{
    const div=document.createElement('div');
    div.className=`checklist-item ${t.completed?'completed':''}`;
    div.innerHTML=`
      <div class="checkbox ${t.completed?'checked':''}" onclick="toggleTask(${i})"></div>
      <span class="subject-tag subject-${t.subject}">${t.subject}</span>
      <span class="task-text ${t.completed?'completed':''}">${t.text}</span>`;
    c.appendChild(div);
  });
}
function toggleTask(i) {
  checklistData[i].completed=!checklistData[i].completed;
  localStorage.setItem('checklist',JSON.stringify(checklistData));
  renderChecklist();updateProgress();
  const allDone=checklistData.every(t=>t.completed);
  if(allDone && !localStorage.getItem(`completed-${selectedDate}`)){
    localStorage.setItem(`completed-${selectedDate}`,'true');
    incrementStreak();playConfetti();
  }
}
function updateProgress() {
  const done=checklistData.filter(t=>t.completed).length;
  const pct=Math.round(done/checklistData.length*100);
  document.getElementById('progress-fill').style.width=pct+'%';
  document.getElementById('progress-text').textContent=pct+'% completed';
}
function loadStreak() {
  document.getElementById('streak-number').textContent=localStorage.getItem('streak')||0;
}
function incrementStreak() {
  const s=parseInt(localStorage.getItem('streak')||0)+1;
  localStorage.setItem('streak',s);
  document.getElementById('streak-number').textContent=s;
}
function updateDate() {
  document.getElementById('today-date').textContent=new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
}

/* ---------- CALENDAR ---------- */
function initializeCalendar() {
  const el=document.getElementById('calendar');
  calendar=new FullCalendar.Calendar(el,{
    initialView:'dayGridMonth',
    height:350,
    headerToolbar:{left:'prev,next',center:'title',right:'today'},
    dateClick(info){
      selectedDate=info.dateStr;
      loadReflection(selectedDate);
    }
  });calendar.render();
}

/* ---------- REFLECTION ---------- */
function saveReflection() {
  const r={
    todayPlan:document.getElementById('today-plan').value,
    todayDone:document.getElementById('today-done').value,
    achievements:document.getElementById('achievements').value,
    regrets:document.getElementById('regrets').value,
    mistakes:document.getElementById('mistakes').value,
    timestamp:new Date().toISOString()
  };
  localStorage.setItem(`reflection-${selectedDate}`,JSON.stringify(r));
  document.getElementById('last-saved').textContent='Last saved: '+new Date().toLocaleTimeString();
  if(isSignedIn) syncWithGoogleCalendar();
}
function loadReflection(date) {
  const r=JSON.parse(localStorage.getItem(`reflection-${date}`)||'{}');
  ['today-plan','today-done','achievements','regrets','mistakes'].forEach(id=>{
    document.getElementById(id).value=r[id]||'';
  });
  document.getElementById('last-saved').textContent=r.timestamp?'Last saved: '+new Date(r.timestamp).toLocaleTimeString():'Not saved yet';
}

/* ---------- GOOGLE CALENDAR SYNC ---------- */
function handleCredentialResponse(response) {
  // response.credential is a JWT (access token)
  gapi.load('client',()=>{
    gapi.client.init({apiKey,discoveryDocs:['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest']})
      .then(()=>{
        gapi.client.setToken({access_token:response.credential});
        isSignedIn=true;
        syncWithGoogleCalendar();
      });
  });
}
async function syncWithGoogleCalendar() {
  if(!isSignedIn) return;
  try{
    const list=await gapi.client.calendar.calendarList.list();
    let cal=list.result.items.find(c=>c.summary==='NEET Tracker');
    if(!cal){
      const res=await gapi.client.calendar.calendars.insert({summary:'NEET Tracker',description:'NEET 2026 Study Dashboard'});
      cal=res.result;
    }
    const checklist=checklistData;
    const reflection=JSON.parse(localStorage.getItem(`reflection-${selectedDate}`)||'{}');
    const done=checklist.every(t=>t.completed);
    const event={
      summary:`NEET Study Day - ${done?'‚úÖCompleted':'In Progress'}`,
      description:`Checklist:\n${checklist.map(t=>`- [${t.completed?'x':' '}] ${t.text}`).join('\n')}\n\nReflection:\nPlan: ${reflection.todayPlan||'N/A'}\nDone: ${reflection.todayDone||'N/A'}\nAchievements: ${reflection.achievements||'N/A'}\nRegrets: ${reflection.regrets||'N/A'}\nMistakes: ${reflection.mistakes||'N/A'}`,
      start:{date:selectedDate},end:{date:selectedDate}
    };
    const events=await gapi.client.calendar.events.list({calendarId:cal.id,timeMin:selectedDate+'T00:00:00Z',timeMax:selectedDate+'T23:59:59Z'});
    const existing=events.result.items.find(e=>e.summary.includes('NEET Study Day'));
    if(existing){
      await gapi.client.calendar.events.update({calendarId:cal.id,eventId:existing.id,resource:event});
    }else{
      await gapi.client.calendar.events.insert({calendarId:cal.id,resource:event});
    }
  }catch(e){console.error(e)}
}

/* ---------- POMODORO ---------- */
let pomodoroSec = 25 * 60;
let pomodoroInterval = null;
let pomodoroIsBreak = false;

function pomodoroRender() {
  const min = Math.floor(pomodoroSec / 60);
  const sec = (pomodoroSec % 60).toString().padStart(2, '0');
  document.getElementById('timer').textContent = `${min}:${sec}`;
  document.getElementById('mode').textContent = pomodoroIsBreak ? 'Break' : 'Work';
}
function pomodoroStart() {
  if (pomodoroInterval) return;
  pomodoroInterval = setInterval(() => {
    pomodoroSec--;
    pomodoroRender();
    if (pomodoroSec <= 0) pomodoroNext();
  }, 1000);
}
function pomodoroPause() { clearInterval(pomodoroInterval); pomodoroInterval = null; }
function pomodoroReset() {
  pomodoroPause();
  pomodoroIsBreak = false;
  pomodoroSec = 25 * 60;
  pomodoroRender();
}
function pomodoroNext() {
  pomodoroIsBreak = !pomodoroIsBreak;
  pomodoroSec = pomodoroIsBreak ? 5 * 60 : 25 * 60;
  pomodoroRender();
  // beep
  new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU').play();
}

/* ---------- UTIL ---------- */
function playConfetti() {
  confetti({particleCount:100,spread:70,origin:{y:.6},colors:['#667eea','#764ba2','#f093fb','#f5576c']});
}
</script>
</body>
</html>
